<!doctype html>
<meta charset="utf-8">
<title>Dagre Test Page</title>

<style>
h2 {
  color: #333;
}

.error {
  color: red;
}

.node rect {
  stroke-width: 1.5px;
  stroke: #333;
  fill: #fff;
}

.node text {
  font-size: 18px;
}

#node-A {
  font-size: 32px;
}

#node-A .big {
  font-size: 40px;
  font-weight: bold;
}

#node-C {
  color: red;
}

#node-E rect {
  fontName: arial;
  fill: #acf;
}

.edge {
  fill: none;
  stroke-width: 1.5px;
  stroke: #333;
}

#edge-A-B-0 {
  stroke: green;
  stroke-width: 3px;
}
</style>

<h2>Graph Definition</h2>

<textarea id="input" rows="5" cols="80" style="display: block" onKeyUp="tryDraw();">
/* Example */
digraph {
    A [label="<div>A <span class='big'>Big</span> <span style='color:red;'>HTML</span> Source!</div>"];
    C;
    E [label="A blue sink!"];
    A -&gt; B -&gt; C;
    B -&gt; D -&gt; E;
    C -&gt; E;
    A -&gt; D;
}
</textarea>

<h2>Graph Visualization</h2>

<svg width=0 height=0></svg>

<script src="dagre.js"></script>

<script>
  var input = document.querySelector("#input");

  var svgRoot = document.querySelector("svg");

  var graphRE = /[?&]graph=([^&]+)/;
  var graphMatch = window.location.search.match(graphRE);
  if (graphMatch) {
    input.value = decodeURIComponent(graphMatch[1]);
  }

  tryDraw();

  function graphToURL() {
    return [window.location.protocol, '//',
            window.location.host,
            window.location.pathname,
            '?graph=', encodeURIComponent(input.value)].join('');
  }

  var oldInputValue;
  function tryDraw() {
    var g;

    if (oldInputValue !== input.value) {
      oldInputValue = input.value;
      try {
        g = dagre.graph.read(input.value);
      } catch (e) {
        input.setAttribute("class", "error");
      }
    }

    if (g) {
      while (svgRoot.hasChildNodes()) {
        svgRoot.removeChild(svgRoot.lastChild);
      }

      var svg = document.createElementNS("http://www.w3.org/2000/svg", "g");
      svg.setAttribute("transform", "translate(5, 5)");
      svgRoot.appendChild(svg);

      input.setAttribute("class", "");
      dagre.render(g, svg);

      var bbox = svgRoot.getBBox();
      svgRoot.setAttribute("width", bbox.width + 10);
      svgRoot.setAttribute("height", bbox.height + 10);
    }
  }
</script>
